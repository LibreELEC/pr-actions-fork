name: Create PR to LibreELEC/pr-actions
on:
  workflow_dispatch:
permissions:
  contents: read
jobs:
  create-pr:
    runs-on: ubuntu-latest
    steps:
      - name: Generate GitHub App token
        id: app-token
        uses: actions/create-github-app-token@v2
        with:
          app-id: ${{ secrets.APP_ID }}
          private-key: ${{ secrets.APP_PRIVATE_KEY }}
          owner: LibreELEC
      - name: Checkout fork repo (ensure branch exists)
        uses: actions/checkout@v6
        with:
          token: ${{ steps.app-token.outputs.token }}
          repository: LibreELEC/pr-actions-fork
          ref: testy5554
      - name: Create Pull Request
        env:
          GH_TOKEN: ${{ steps.app-token.outputs.token }}
        run: |
          GH_DEBUG=api gh pr create \
            --repo LibreELEC/pr-actions \
            --base master \
            --head pr-actions-fork:testy5554 \
            --title "Test PR from fork (testy5554)" \
            --body "Automated PR created using GitHub App token."
      # - name: Create Pull Request (GraphQL â€“ fork-safe)
      #   env:
      #     GH_TOKEN: ${{ steps.app-token.outputs.token }}
      #   run: |
      #     set -e
      #     # Get repository IDs
      #     BASE_REPO_ID=$(gh api graphql -f query='
      #       query {
      #         repository(owner: "LibreELEC", name: "pr-actions") {
      #           id
      #         }
      #       }' --jq '.data.repository.id')

      #     HEAD_REPO_ID=$(gh api graphql -f query='
      #       query {
      #         repository(owner: "LibreELEC", name: "pr-actions-fork") {
      #           id
      #         }
      #       }' --jq '.data.repository.id')

      #     # Create pull request
      #     gh api graphql -f query='
      #       mutation(
      #         $baseRepo: ID!,
      #         $headRepo: ID!
      #       ) {
      #         createPullRequest(input: {
      #           repositoryId: $baseRepo
      #           baseRefName: "master"
      #           headRefName: "testy5554"
      #           headRepositoryId: $headRepo
      #           title: "Test PR from fork (testy5554)"
      #           body: "Automated PR created using GitHub App token via GraphQL."
      #         }) {
      #           pullRequest {
      #             number
      #             url
      #           }
      #         }
      #       }' \
      #       -f baseRepo="$BASE_REPO_ID" \
      #       -f headRepo="$HEAD_REPO_ID"
